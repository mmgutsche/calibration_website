{% extends 'base.html' %}

{% block title %}Calibration Test{% endblock %}

{% block content %}
<h1 class="mt-5">Calibrate Yourself</h1>
<!-- Updated introduction text -->
<div class="mt-4 mb-4 border-bottom">
    <h2>How to become better at judging your own uncertainty</h2>
    <p><strong>Why Calibration Matters:</strong> Inspired by the insights from "How to Measure Anything," this
        tool emphasizes the idea that with the right techniques, it is possible to measure almost anything, even
        perceptions of immeasurable. Through this app, you'll learn to quantify your uncertainties and make
        better-informed decisions.</p>
    <p><strong>How It Works:</strong> Practice estimating answers within a 90% confidence range, and refine your
        skills in assessing the probability and impact of various outcomes.</p>
    <p><strong>Further Learning:</strong> Discover more about effective measurement techniques and their
        applications in decision-making on this <a
            href="https://www.lesswrong.com/posts/ybYBCK9D7MZCcdArB/how-to-measure-anything">resource page</a>.
    </p>
</div>
<div id="errorBanner" class="alert alert-danger d-none" role="alert"></div>
<form id="calibrationForm" class="mt-4" method="post" action="/submit">
    <div id="questionsContainer">

    </div>
    <button type="submit" class="btn btn-primary mt-3">Submit</button>
</form>
<div id="result" class="mt-3"></div>
<div id="progress" class="mt-4 mb-4">
    <!-- Display progress if cookies are accepted -->
    <h3>Your Progress</h3>
    <div id="progressContent">No progress data available. If you do not accept cookies, your progress won't be saved.
    </div>
    <button id="deleteCookiesBtn" class="btn btn-danger d-none" onclick="deleteCookies()">Delete Progress</button>
</div>
<script>
    function displayProgress() {
        if (document.cookie.includes('cookieConsent=true')) {
            const testResults = getCookie('test_results');
            if (testResults) {
                try {
                    const results = JSON.parse(testResults);
                    let progressContent = "<ul>";
                    results.forEach(result => {
                        progressContent += `<li>${result.date}: ${result.score}%</li>`;
                    });
                    progressContent += "</ul>";
                    document.getElementById('progressContent').innerHTML = progressContent;
                    document.getElementById('deleteCookiesBtn').classList.remove('d-none');
                } catch (e) {
                    console.error("Error parsing test results:", e);
                    document.getElementById('progressContent').innerHTML = "Error loading progress data.";
                }
            } else {
                document.getElementById('progressContent').innerHTML = "No progress data available.";
            }
        } else {
            document.getElementById('progressContent').innerHTML = "Cookie consent not given. Progress won't be saved.";
        }
    }
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    function deleteCookies() {
        document.cookie = "test_results=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        location.reload();
    }
    window.onload = function () {
        checkCookie();
        displayProgress();
    };
</script>

{% endblock %}